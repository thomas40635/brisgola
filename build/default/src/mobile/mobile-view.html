<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="mobile-view">
  <template>
    <style>
      :host {
	    display: inline-block;
	    width:100%;
	  	height:100%;
	  	position: relative;
	  }
	  .page{
		position: relative;
		height:100%;
		overflow:hidden;
	  }
	  .background{
	  	width:100%;
	  	position: absolute;
	  	left:0px;
	  	top:0px;
	  	z-index:0;
	  }
	  .part{
	  	height:100%;
	  	position: relative;
	  	z-index:1;
	  }
	  .bottom{
		position: absolute;
		bottom:20px;
		width:100%;
	  }
	  .big-button{
		border-radius: 100px;
		padding-top:26px;
		padding-bottom:34px;
		font-size:16px;
		color:#493d6b;
		background: #fff;
		box-shadow:0px 10px 10px rgba(72,60,108,0.5),
		0px -8px 0px 0px rgba(72,60,108,0.15) inset;
		text-transform: uppercase;
		font-weight: 900;
		width:calc(100% - 40px);
		margin:0px 20px;
		text-align:center;
	  }
    </style>

    <app-location route="{{route}}"></app-location>

    <iron-ajax id="createPlayer" method="POST" url="../../src/webservices/createPlayer.php" content-type="application/json" handle-as="json" on-response="handleResponse">
    </iron-ajax>

    <app-route route="{{route}}" pattern="/:view" data="{{routeData}}" tail="{{subroute}}"></app-route>
	
	<div class="page">

	<div class="part">
		<div class="bottom">
			<div class="big-button">
				Toucher pour jouer
			</div>
		</div>
    </div>
	
	<div class="part">
		<div class="bottom">
			<div class="big-button">
				Toucher pour jouer
			</div>
		</div>
    </div>
	<img src="../../src/img/mobile-background.png" class="background" alt="">
    </div>

  </template>

  <script>/**
 * @customElement
 * @polymer
 */
class MobileView extends Polymer.Element {
  static get is() {
    return 'mobile-view';
  }

  static get properties() {
    return {};
  }

  start() {
    if (this.$_GET('code')) {
      this.$.code.value = this.$_GET('code');
    }

    var rand = Math.floor(Math.random() * 99 + 1);
    var playerID = "player" + rand;
    this.$.pseudo.value = playerID;
  }

  connect() {
    var playerID = this.$.pseudo.value;
    this.$.createPlayer.body = '{"code": "' + this.$.code.value + '","playerID": "' + playerID + '"}';
    this.$.createPlayer.generateRequest();
  }

  $_GET(param) {
    var vars = {};
    window.location.href.replace(location.hash, '').replace(/[?&]+([^=&]+)=?([^&]*)?/gi, // regexp
    function (m, key, value) {
      // callback
      vars[key] = value !== undefined ? value : '';
    });

    if (param) {
      return vars[param] ? vars[param] : null;
    }

    return vars;
  }

}

window.customElements.define(MobileView.is, MobileView);</script>
</dom-module>
