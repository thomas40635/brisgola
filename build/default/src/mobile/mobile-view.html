<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="mobile-view">
  <template>
    <style>
      :host {
	    display: inline-block;
	    width:100%;
	  	height:100%;
	  	position: relative;
	  	background: url(../img/space.png) no-repeat center center fixed; 
		-webkit-background-size: cover;
		-moz-background-size: cover;
		-o-background-size: cover;
		background-size: cover;
	  }
	  .page{
		padding:20px;
		padding-top:10px;
		padding-bottom:30px;
		background: #fff;
		display: inline-block;
		position: relative;
		border-radius:10px;
		box-shadow: 0px 20px 30px rgba(0,0,0,0.2),
		0px -10px 0px 0px #f1f0f3 inset;
		height:calc(100% - 80px);
		width:calc(100% - 80px);
		margin:20px;
	  }
	  .center{
	  	top:50%;
	  	left:50%;
	  	position: relative;
	  	display: inline-block;
	  	transform:translateX(-50%) translateY(-50%);
	  	text-align: center;
	  }
	  .submit{
	  	border-radius: 10px;
	  	padding:20px;
		color:#483c6c;
	  	font-size:18px;
		font-weight:900;
		background: #31ee93;
		text-align: center;
		text-transform:uppercase;
		border:none;
	  }
	  .textbox{
	  	border-radius: 10px;
	  	border:none;
	  	margin-bottom:20px;
	  	padding:20px;
		color:#483c6c;
	  	font-size:18px;
		font-weight:900;
		background: #f1f0f3;
		text-align: center;
		text-transform: uppercase;
	  }
	  .textbox::placeholder{
		color:#cbc5d6;
	  }
    </style>

    <app-location route="{{route}}"></app-location>

    <iron-ajax id="createPlayer" method="POST" url="../../src/webservices/createPlayer.php" content-type="application/json" handle-as="json" on-response="handleResponse">
    </iron-ajax>

    <app-route route="{{route}}" pattern="/:view" data="{{routeData}}" tail="{{subroute}}"></app-route>
	
	<div class="page">
		<div class="center">
		    <input type="text" class="textbox" id="code" placeholder="PLANETE">
		    <br>
		    <input type="text" class="textbox" id="pseudo" placeholder="PSEUDO">
		    <br>
		    <input type="submit" on-click="connect" class="submit" value="Jouer">
	    </div>
    </div>
  </template>

  <script>/**
 * @customElement
 * @polymer
 */
class MobileView extends Polymer.Element {
  static get is() {
    return 'mobile-view';
  }

  static get properties() {
    return {};
  }

  start() {
    if (this.$_GET('code')) {
      this.$.code.value = this.$_GET('code');
    }

    var rand = Math.floor(Math.random() * 99 + 1);
    var playerID = "player" + rand;
    this.$.pseudo.value = playerID;
  }

  connect() {
    var playerID = this.$.pseudo.value;
    this.$.createPlayer.body = '{"code": "' + this.$.code.value + '","playerID": "' + playerID + '"}';
    this.$.createPlayer.generateRequest();
  }

  $_GET(param) {
    var vars = {};
    window.location.href.replace(location.hash, '').replace(/[?&]+([^=&]+)=?([^&]*)?/gi, // regexp
    function (m, key, value) {
      // callback
      vars[key] = value !== undefined ? value : '';
    });

    if (param) {
      return vars[param] ? vars[param] : null;
    }

    return vars;
  }

}

window.customElements.define(MobileView.is, MobileView);</script>
</dom-module>
