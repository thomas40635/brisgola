<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="mobile-view">
  <template>
    <style>
      :host {
	    display: inline-block;
	    width:100%;
	  	height:100%;
	  	position: relative;
	  }
	  .page{
		position: relative;
		height:100%;
		overflow:hidden;
	  }
	  .background{
	  	width:100%;
	  	position: absolute;
	  	left:0px;
	  	z-index:0;
	  }
	  .background-1{
	  	top:0px;
	  }
	  .background-2{
	  	top:50px;
	  }
	  .background-3{
	  	top:100px;
	  }
	  .part{
	  	height:100%;
	  	width:100%;
	  	position: absolute;
	  	top:0px;
	  	left:0px;
	  	z-index:1;
	  	transition:all 0.5s;
	  }
	  .part-previous{
	  	top:-100%;
	  }
	  .part-next{
	  	top:100%;
	  }
	  .bottom{
		position: absolute;
		bottom:20px;
		width:100%;
	  }
	  .big-button{
		border-radius: 100px;
		padding-top:26px;
		padding-bottom:34px;
		font-size:16px;
		color:#493d6b;
		background: #fff;
		box-shadow:0px 10px 10px rgba(72,60,108,0.5),
		0px -8px 0px 0px rgba(72,60,108,0.15) inset;
		text-transform: uppercase;
		font-weight: 900;
		width:calc(100% - 40px);
		margin:0px 20px;
		text-align:center;
	  }
	  .textbox{
		border-radius: 100px;
		padding-top:26px;
		padding-bottom:34px;
		font-size:16px;
		color:#493d6b;
		background: #fff;
		box-shadow:0px 10px 10px rgba(72,60,108,0.5),
		0px -8px 0px 0px rgba(72,60,108,0.15) inset;
		text-transform: uppercase;
		font-weight: 900;
		width:calc(100% - 40px);
		margin:0px 20px;
		text-align:center;
		border:none;
		font-family: "Google Sans";
		margin-bottom:20px;
	  }
    </style>

    <app-location route="{{route}}"></app-location>

    <iron-ajax
    id="createPlayer"
    method="POST"
    url="../../src/webservices/createPlayer.php"
    content-type="application/json"
    handle-as="json"
    on-response="handleResponse">
    </iron-ajax>

    <app-route
    route="{{route}}"
    pattern="/:view"
    data="{{routeData}}"
    tail="{{subroute}}"></app-route>
	
	<div class="page">

	<div class="part part-focus" id="home">
		<div class="bottom">
			<div class="big-button" on-click="nextStep">
				Home
			</div>
		</div>
    </div>
	
	<div class="part part-next" id="connect">
		<div class="bottom">
			<input type="text" class="textbox" id="code" placeholder="PLANETE">
			<input type="text" class="textbox" id="pseudo" placeholder="PSEUDO">
			<div class="big-button" on-click="nextStep">
				Connect
			</div>
		</div>
    </div>
	
	<div class="part part-next" id="game">
		<div class="bottom">
			<div class="big-button" on-click="nextStep">
				PLay
			</div>
		</div>
    </div>

	<img src="../../src/img/mobile-background.png" id="background" class="background" alt="">

    </div>

  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    class MobileView extends Polymer.Element {
      static get is() { return 'mobile-view'; }
      static get properties() {
        return {
          step:{
          	observer:'stepChanged'
          }
        };
      }

      start(){
      	this.set('step', "home")
      	// if(this.$_GET('code')){
      	// 	this.$.code.value = this.$_GET('code');
      	// 	this.set('step', "connect")
      	// }
      	var rand = Math.floor((Math.random() * 99) + 1)
      	var playerID = "player"+rand;
      	this.$.pseudo.value = playerID;
      }

      backStep(){
      	if(this.step == "connect"){
      		this.set('step', "home")
      	}
      	if(this.step == "game"){
      		this.set('step', "connect")
      	}
      }

      nextStep(){
      	console.log(this.step)
      	if(this.step == "home"){
      		this.set('step', "connect")
      	}
      	else if(this.step == "connect"){
      		this.set('step', "game")
      	}
      }

      stepChanged(){
      	console.log(this.step)
      	this.$.home.className = "part"
      	this.$.connect.className = "part"
      	this.$.game.className = "part"

      	if(this.step == "home"){
      		this.$.home.classList.add("part-focus")
      		this.$.connect.classList.add("part-next")
      		this.$.game.classList.add("part-next")
      	}
      	else if(this.step == "connect"){
      		this.$.home.classList.add("part-previous")
      		this.$.connect.classList.add("part-focus")
      		this.$.game.classList.add("part-next")
      	}
      	else if(this.step == "game"){
      		this.$.home.classList.add("part-previous")
      		this.$.connect.classList.add("part-previous")
      		this.$.game.classList.add("part-focus")
      	}
      }

      connect(){
    	var playerID = this.$.pseudo.value
    	this.$.createPlayer.body = '{"code": "'+this.$.code.value+'","playerID": "'+playerID+'"}';
  		this.$.createPlayer.generateRequest();
      }

	     $_GET(param) {
			var vars = {};
			window.location.href.replace( location.hash, '' ).replace( 
				/[?&]+([^=&]+)=?([^&]*)?/gi, // regexp
				function( m, key, value ) { // callback
					vars[key] = value !== undefined ? value : '';
				}
			);

			if ( param ) {
				return vars[param] ? vars[param] : null;	
			}
			return vars;
		}
    }

    window.customElements.define(MobileView.is, MobileView);
  </script>
</dom-module>
