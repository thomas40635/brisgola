<script src="../../vendor/qrcode/qrcode.js"></script>

<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="desktop-view">
  <template>
    <style>

	  :host {
	    display: inline-block;
	    width:100%;
	  	height:100%;
	  	position: relative;
	  	background: url(../img/space.png) no-repeat center center fixed; 
		-webkit-background-size: cover;
		-moz-background-size: cover;
		-o-background-size: cover;
		background-size: cover;
	  }

	  .page{
		padding:40px;
		background: #fff;
		display: inline-block;
		position: relative;
		border-radius:10px;
		box-shadow: 0px 20px 30px rgba(0,0,0,0.2),
		0px -10px 0px 0px rgba(0,0,0,0.05) inset;
		height:calc(100% - 160px);
		width:calc(100% - 160px);
	  }

	  .center{
	  	top:50%;
	  	left:50%;
	  	position: relative;
	  	display: inline-block;
	  	transform:translateX(-50%) translateY(-50%);
	  	text-align: center;
	  }

	  .qrcode{
	  	display: inline-block;
	  	position: relative;
	  	width: 200px;
		height: 200px;
	  }

	  .or{
	  	font-size:14px;
	  	color:#dce3e9;
	  	font-family: "Gotham";
	  	padding:20px;
	  }

	  .code{
	  	font-size:32px;
	  	color:#262a2d;
	  	font-family: "Gotham";
	  	font-weight:900;
	  }

	  .separe{
	  	height:20px;
	  }

	  .arrow{
	  	width:10px;
	  	height:10px;
	  	display: inline-block;
	  	transform: rotate(45deg);
	  	border-right:4px solid #262a2d;
	  	border-bottom:4px solid #262a2d;
	  	margin:20px 0px;
	  }

	  .player{
	  	padding:20px;
	  	border:4px solid #dce3e9;
	  	border-radius: 100px;
	  	font-size:18px;
	  	font-family:"Gotham";
	  	color:#262a2d;
	  }

    </style>

    <iron-ajax
    id="createParty"
    method="POST"
    url="../../src/webservices/createParty.php"
    content-type="application/json"
    handle-as="json">
    </iron-ajax>

    <iron-ajax
    id="refreshPlayers"
    method="POST"
    url="../../src/webservices/refreshPlayers.php"
    content-type="application/json"
    handle-as="json"
    on-response="playersConnect"
    last-response="{{players}}">
    </iron-ajax>

    <div class="page center">
	
    </div>
  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    class DesktopView extends Polymer.Element {
      static get is() { return 'desktop-view'; }
      static get properties() {
        return {

        };
      }

      start(){
      	var rand = Math.floor((Math.random() * 999999) + 1)
      	var code = rand.toString().padStart(6, "0");
      	this.set('code', code)
      	this.$.code.innerHTML = "#"+code
      	var qrcode = new QRCode(this.$.qrcode, {
		    text: "http://thomaspaul.fr/?code="+code,
		    width: 200,
		    height: 200,
		    colorDark : "#262a2d",
		    colorLight : "#fff",
		    correctLevel : QRCode.CorrectLevel.H
		});
		this.$.createParty.body = JSON.stringify(this.code);
  		this.$.createParty.generateRequest();
  		this.refreshPlayers();

      }

      playersConnect(){
      	var players = this.$.refreshPlayers.lastResponse
      	this.set('player1',this.$.refreshPlayers.lastResponse[0])
      	this.set('player2',this.$.refreshPlayers.lastResponse[1])
      	this.set('player3',this.$.refreshPlayers.lastResponse[2])
      }

      refreshPlayers() {
      	var self = this
		    setTimeout(function () {
		        self.$.refreshPlayers.body = '{"code": '+self.code+'}';
  				self.$.refreshPlayers.generateRequest();
  				console.log("check players : "+self.code);
  				self.refreshPlayers();
		    }, 1000);
		}


    }

    window.customElements.define(DesktopView.is, DesktopView);
  </script>
</dom-module>
